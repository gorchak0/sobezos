# Theory Service (sobezos)

## Описание

Theory Service — это микросервис платформы Sobezos, отвечающий за хранение, выдачу и управление теоретическими заданиями, тегами и связанными сущностями. Сервис реализует CRUD-операции для задач, поддерживает работу с тегами, а также предоставляет API для получения и проверки ответов пользователей.

## Основные возможности

- Хранение теоретических задач и тегов
- Добавление, редактирование, получение задач и тегов
- Получение задачи по id и по тегам
- Проверка и получение ответов на задачи
- Миграции и управление схемой БД
- Интеграция с другими сервисами Sobezos

## Структура проекта

```
services/theory-service/
├── Dockerfile                # Docker-образ для сервиса
├── go.mod, go.sum            # Зависимости Go
├── cmd/
│   └── theory-service/
│       └── main.go           # Точка входа приложения
├── config/
│   └── env.go                # Загрузка переменных окружения
├── internal/
│   ├── config/
│   │   └── db.go             # Инициализация подключения к БД
│   ├── handler/
│   │   ├── answer_get.go     # Получение ответа
│   │   ├── get_task_id.go    # Получение задачи по id
│   │   ├── tag_get.go        # Получение тегов
│   │   ├── task_add.go       # Добавление задачи
│   │   ├── task_edit.go      # Редактирование задачи
│   │   ├── task_get.go       # Получение задач
│   │   └── task_handler.go   # Общий обработчик задач
│   ├── migrations/
│   │   ├── 001_create_tasks_table.sql
│   │   ├── 002_create_tags_table.sql
│   │   ├── 003_create_tasks_tags_table.sql
│   │   └── migrate.go        # Скрипт миграции
│   ├── repository/
│   │   └── task_repository.go# Работа с задачами в БД
│   └── service/
│       └── task_service.go   # Бизнес-логика задач
├── pkg/
│   └── models/
│       ├── tag.go            # Модель тега
│       ├── task.go           # Модель задачи
│       └── task_tag.go       # Модель связи задача-тег
```

## Запуск

### 1. Переменные окружения

Создайте файл `.env` (если требуется) и укажите параметры подключения к БД и другие настройки.

### 2. Миграции

Перед первым запуском выполните миграции:

```
go run ./internal/migrations/migrate.go
```

### 3. Сборка и запуск через Docker

```
docker build -t sobezos-theory-service .
docker run sobezos-theory-service
```

Или используйте общий `docker-compose.yml` на уровень выше для запуска всех сервисов:

```
docker compose -f ../docker-compose.yml up -d theory-service
```

### 4. Локальный запуск

```
go run ./cmd/theory-service/main.go
```

## Взаимодействие с другими сервисами

Theory Service предоставляет API для других микросервисов (bot-service, user-service и др.) для получения, добавления и проверки теоретических задач и тегов.

## Основные компоненты

- **main.go** — инициализация зависимостей, запуск сервиса
- **db.go** — подключение к базе данных
- **handler/** — обработчики HTTP-запросов
- **service/** — бизнес-логика
- **repository/** — работа с БД
- **migrations/** — миграции схемы БД
- **models/** — структуры данных

## Пример архитектуры

```
[Bot Service] ⇄ [Theory Service]
[User Service] ⇄ [Theory Service]
```

## Требования

- Go 1.20+
- Docker (для контейнеризации)
- PostgreSQL (или другая поддерживаемая БД)

## Разработка и тестирование

- Бизнес-логика и обработчики вынесены в отдельные пакеты
- Для тестирования используйте mock-данные или тестовую БД
- Логи пишутся в stdout/stderr

## Безопасность

- Не публикуйте .env и другие секреты в публичные репозитории
- Используйте переменные окружения для конфигурации

## Авторы и поддержка

- Проект Sobezos, 2025
- Вопросы и баги — через Issues на GitHub
