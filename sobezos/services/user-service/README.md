# User Service (sobezos)

## Описание

User Service — это микросервис платформы Sobezos, отвечающий за регистрацию, хранение, проверку и управление пользователями и их состояниями. Сервис реализует CRUD-операции для пользователей, хранит состояния (user_state), предоставляет API для других сервисов и поддерживает миграции схемы БД.

## Основные возможности

- Регистрация и проверка пользователей
- Получение и обновление состояния пользователя (user_state)
- Хранение ролей и другой информации о пользователях
- Миграции и управление схемой БД
- Интеграция с другими сервисами Sobezos

## Структура проекта

```
services/user-service/
├── .env                      # Переменные окружения (например, параметры БД)
├── Dockerfile                # Docker-образ для сервиса
├── go.mod, go.sum            # Зависимости Go
├── cmd/
│   └── user-service/
│       └── main.go           # Точка входа приложения
├── internal/
│   ├── handlers/
│   │   ├── add_user.go       # Добавление пользователя
│   │   ├── check_user.go     # Проверка пользователя
│   │   ├── get_state.go      # Получение состояния пользователя
│   │   ├── patch_state.go    # Обновление состояния пользователя
│   │   └── users.go          # Получение списка пользователей
│   ├── migrations/
│   │   ├── 001_create_users_table.sql
│   │   ├── 002_create_user_states_table.sql
│   │   └── migrate.go        # Скрипт миграции
│   ├── repository/
│   │   ├── user_repository.go        # Работа с пользователями
│   │   └── user_state_repository.go  # Работа с состояниями пользователей
│   └── service/
│       └── user_service.go   # Бизнес-логика пользователей
├── pkg/
│   └── models/
│       ├── user.go           # Модель пользователя
│       └── user_state.go     # Модель состояния пользователя
```

## Запуск

### 1. Переменные окружения

Создайте файл `.env` и укажите параметры подключения к БД и другие настройки.

### 2. Миграции

Перед первым запуском выполните миграции:

```
go run ./internal/migrations/migrate.go
```

### 3. Сборка и запуск через Docker

```
docker build -t sobezos-user-service .
docker run --env-file .env sobezos-user-service
```

Или используйте общий `docker-compose.yml` на уровень выше для запуска всех сервисов:

```
docker compose -f ../docker-compose.yml up -d user-service
```

### 4. Локальный запуск

```
go run ./cmd/user-service/main.go
```

## Взаимодействие с другими сервисами

User Service предоставляет API для других микросервисов (bot-service, theory-service и др.) для регистрации, проверки и получения информации о пользователях и их состояниях.

## Основные компоненты

- **main.go** — инициализация зависимостей, запуск сервиса
- **handlers/** — обработчики HTTP-запросов
- **service/** — бизнес-логика
- **repository/** — работа с БД
- **migrations/** — миграции схемы БД
- **models/** — структуры данных

## Пример архитектуры

```
[Bot Service] ⇄ [User Service]
[Theory Service] ⇄ [User Service]
```

## Требования

- Go 1.20+
- Docker (для контейнеризации)
- PostgreSQL (или другая поддерживаемая БД)

## Разработка и тестирование

- Бизнес-логика и обработчики вынесены в отдельные пакеты
- Для тестирования используйте mock-данные или тестовую БД
- Логи пишутся в stdout/stderr

## Безопасность

- Не публикуйте .env и другие секреты в публичные репозитории
- Используйте переменные окружения для конфигурации

## Авторы и поддержка

- Проект Sobezos, 2025
- Вопросы и баги — через Issues на GitHub
