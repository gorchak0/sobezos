# Bot Service (sobezos)

## Описание

Bot Service — это микросервис, реализующий Telegram-бота для взаимодействия с пользователями платформы Sobezos. Сервис отвечает за обработку команд, хранение пользовательских состояний, маршрутизацию задач, работу с тегами и интеграцию с другими сервисами системы через API.

## Основные возможности

- Приём и обработка команд Telegram
- Регистрация и аутентификация пользователей
- Управление задачами (добавление, получение, редактирование)
- Работа с тегами (добавление, получение, очистка)
- Получение и сохранение ответов пользователей
- Хранение и обновление состояния пользователя
- Взаимодействие с другими микросервисами (user-service, code-service, theory-service и др.)

## Структура проекта

```
services/bot-service/
├── .env                  # Переменные окружения (токен Telegram и др.)
├── Dockerfile            # Docker-образ для сервиса
├── go.mod, go.sum        # Зависимости Go
├── cmd/
│   └── bot-service/
│       └── main.go       # Точка входа приложения
├── internal/
│   ├── config/
│   │   └── env.go        # Загрузка переменных окружения
│   ├── handler/
│   │   └── handler.go    # HTTP/Telegram обработчики
│   ├── models/
│   │   └── user_state.go # Модели состояния пользователя
│   └── service/
│       ├── answer_get.go # Получение ответов
│       ├── service.go    # Логика сервиса
│       ├── tag_clear.go  # Очистка тегов
│       ├── tag_get.go    # Получение тегов
│       ├── tag_set.go    # Установка тегов
│       ├── task_add.go   # Добавление задач
│       ├── task_edit.go  # Редактирование задач
│       ├── task_get.go   # Получение задач
│       ├── task_get_id.go# Получение задачи по id
│       ├── user_add.go   # Добавление пользователя
│       ├── user_check.go # Проверка пользователя
│       ├── userstate_edit.go # Изменение состояния пользователя
│       └── userstate_get.go  # Получение состояния пользователя
```

## Запуск

### 1. Переменные окружения

Создайте файл `.env` в корне сервиса и укажите:

```
TELEGRAM_TOKEN=your_telegram_token
```

### 2. Сборка и запуск через Docker

```
docker build -t sobezos-bot-service .
docker run --env-file .env sobezos-bot-service
```

Или используйте общий `docker-compose.yml` на уровень выше для запуска всех сервисов:

```
docker compose -f ../docker-compose.yml up -d bot-service
```

### 3. Локальный запуск

```
go run ./cmd/bot-service/main.go
```

## Взаимодействие с другими сервисами

Bot Service обращается к другим микросервисам через HTTP/gRPC API для:

- Проверки и регистрации пользователей
- Получения и сохранения задач, тегов, ответов
- Синхронизации состояния пользователя

## Основные компоненты

- **main.go** — инициализация зависимостей, запуск бота
- **handler.go** — обработка входящих сообщений и команд
- **service.go** — бизнес-логика, маршрутизация команд
- **user_state.go** — структура состояния пользователя
- **tag*\*.go, task*\*.go, answer_get.go** — отдельные обработчики для тегов, задач, ответов

## Пример архитектуры

```
[Telegram] ⇄ [Bot Service] ⇄ [User Service]
                        ⇄ [Theory Service]
                        ⇄ [Code Service]
                        ⇄ [Media Service]
                        ⇄ [Stats Service]
```

## Требования

- Go 1.20+
- Docker (для контейнеризации)
- Доступ к другим сервисам Sobezos (user-service, theory-service и др.)

## Разработка и тестирование

- Все бизнес-правила вынесены в internal/service
- Для тестирования используйте mock-объекты или тестовые endpoints других сервисов
- Логи пишутся в stdout/stderr, поддерживается интеграция с zap

## Безопасность

- Не публикуйте .env и другие секреты в публичные репозитории
- Используйте переменные окружения для токенов и ключей

## Авторы и поддержка

- Проект Sobezos, 2025
- Вопросы и баги — через Issues на GitHub
